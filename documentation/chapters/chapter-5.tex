\chapter{Evolutionary Limits} \label{ch:evolutionary limits}
This chapter inspects evolutionary limits predicted by Vose using infinite population model under no selective pressure. 
It provides computation of predicted limits of infinite population and discusses necessary and sufficient conditions for population to converge in to periodic orbits. 

\section{Limits}
\label{Limits}
Vose states under mild assumptions on mutations (considered later), populations converge under repeated application 
of $\mathcal{M}$. Vose mentions that in general case, periodic orbits are possible but populations converge under 
repeated application of $\mathcal{M}^2$ and limits ${\bm p}^\ast = lim_{n \rightarrow \infty} \mathcal{M}^{2n}({\bm p})$ 
and ${\bm q}^\ast = lim_{n \rightarrow \infty} \mathcal{M}^{2n+1}({\bm q})$ exist.

Following Vose's theorem, let $S_g = g \mathcal{R} / \{\textbf{0}, g\}$, and let $|g|$ be the number of non zero bits in $g$.
\[
{{\widehat{{\bm p}}}_g}^{\prime}  = \begin{cases}
    2^{\ell /2}  & \text{if $g = 0$}\\
    x_g \widehat{{\bm p}}_g + y_g(\widehat{{\bm p}}_g) & \text{otherwise}
  \end{cases}
\]
where,
\[
x_g = 2\widehat{\mathcal{M}}_{g,0},  \hspace*{1cm} y_g(z) = 2^{\ell /2} \sum_{i \in S_g} z_i z_{i+g} \widehat{\mathcal{M}}_{i,i+g}.
\]

Moreover, 
\begin{eqnarray*}
|g| & = & 1 \nudge \Rightarrow y_g = 0 \\
|g| & > & 0 \nudge \Rightarrow |x_g| \leq 1 \\
|x_g| & = & 1 \nudge \Rightarrow y_g = 0
\end{eqnarray*}

With above notations, limits can be expressed in Walsh basis by recursive equations 
\begin{equation}
\label{lt1}
\widehat{{\bm p}^{\ast}}_g  = \begin{cases}
    (x_g y_g(\widehat{{\bm p}^{\ast}}) + y_g(\widehat{{\bm q}^{\ast}}))/(1-x_g^2)  & \text{if $|x_g| < 0$}\\
    \widehat{p}_g  & \text{otherwise}
  \end{cases}
\end{equation}
\begin{equation}
\label{lt2}
\widehat{{\bm q}^{\ast}}_g  = \begin{cases}
    (x_g y_g(\widehat{{\bm q}^{\ast}}) + y_g(\widehat{{\bm p}^{\ast}}))/(1-x_g^2)  & \text{if $|x_g| < 0$}\\
    \widehat{\mathcal{M}({\bm p})_g}  & \text{otherwise}
  \end{cases}
\end{equation}

If $x_g \neq −1$ for all $g$, then ${\bm p}^\ast = {\bm q}^\ast = lim_{n \rightarrow \infty} \mathcal{M}({\bm p})$ is the limit of mixing. In other cases, 
mixing converges to a periodic orbit oscillating between ${\bm p}^\ast$ and ${\bm q}^\ast = \mathcal{M}({\bm p}^\ast)$.

Limits $\widehat{{\bm p}^{\ast}}_g$ and $\widehat{{\bm q}^{\ast}_g}$ can be computed considering $g$th components in order of increasing $|g|$ and 
performing complete indcution on $|g|$. If $|g| = 0$ then $g = 0$. Since $\widehat{{\bm p}^\ast}_0 = 2^{-\ell/2}$ for all distributions ${\bm p}$, 
the $\textbf{0}$the components of the sequence $\mathcal{M}^n({\bm p})$ are identical in the Walsh basis. Since $|x_0| = 2$ ($x_g = 2\widehat{\mathcal{M}}_{g,0}$ 
and $\widehat{\mathcal{M}}_{0,0} = 1$), $\widehat{{\bm p}^{\ast}}_g = \widehat{{\bm q}^{\ast}}_g = 2^{-\ell/2}$. Next, consider $|g| = 1$. $y_g = 0$ for $|g| = 0$ 
(noted from above). These two cases $|g| < 2|$ are base cases for complete induction on $|g|$. The inductive hypothesis given by Vose is that 
for $|k| < |g|$, the $k$th component of $\mathcal{M}^n({\bm p})$ in the Walsh basis converges to $\widehat{{\bm p}^{\ast}}_k$ or $\widehat{{\bm q}^{\ast}}_k$ as 
$n \rightarrow \infty$ through even or odd values respectively, and if $x_k \neq -1$ for all such $k$, then 
$\widehat{{\bm p}^{\ast}}_k$ = $\widehat{{\bm q}^{\ast}}_k$. And computation of $y_g(z)$ involves only the $k$th components of $z$ where $|k| < |g|$. 
\newline 
Vose gives a necessary and sufficient condition for the sequence
\[
p, \mathcal{M}({\bm p}), \mathcal{M}^2({\bm p}),...
\]
to converge to a periodic orbit as that for some $g$
\begin{equation}
\label{OscCond}
-1 = \sum \limits_{j} (-1)^{g^T j} \bm{\mu}_j = - \sum \limits_{k \in \bar{g}\mathcal{R}} \bm{\chi}_{k+g} + \bm{\chi}_k
\end{equation}
 
\section{Computation of Mutation and Crossover Distribution}
Following algorithm installs values of mutation and crossover distributions that satisfies condition described 
by equation (\ref{OscCond}) for evolutionary sequence to converge in periodic orbits.
Let $\bm{\mu}_j$ and $\bm{\chi}_k$ represent mutation and crossover distributions respectively where $j,k \in \mathcal{R}$ 
and $U01()$ be random number between $0$ and $1$. For any $g$ where $g \in \mathcal{R}$ and $g \neq 0$.
For all $j \in \mathcal{R}$,
\[
\bm{\mu}_j = \begin{cases}
    U01() & \text{if $(g^T\cdot j)$ is odd}.\\
    0 & \text{otherwise}.
  \end{cases}
\]

This installs some random values in some specific positions in $\bm{\mu}$ distribution array according to value of $g$ and others set to $0$. 
Normalization of $\bm{\mu}_j$ gives values for $\bm{\mu}$ distribution
\[
\bm{\mu}_j = \bm{\mu}_j / \sum \limits_{j \in \mathcal{R} } \bm{\mu}_j
\]
such that 
\[
\sum \limits_{j \in \mathcal{R} } \bm{\mu}_j = 1.
\]
The values $\bm{\mu}_j$ satisfy condition (\ref{OscCond}) for $\bm{\mu}$ distribution.


Condition $k \in \bar{g} \mathcal{R}$ in equation (\ref{OscCond}) can be simplified for computation as
\[
k = \bar{g} i  \text{ where $i \in \mathcal{R}$}
\]
Logical bitwise ANDing both sides by $\bar{g}$,
\begin{eqnarray*}
\bar{g} k & = & \bar{g} \bar{g} i \\
\bar{g} k & = & \bar{g} i \\
\bar{g} k & = & k 
\end{eqnarray*}

For all $k \in \mathcal{R}$,
\begin{eqnarray*}
\bm{\chi}_k & = & U01() \\
\bm{\chi}_{k+g} & = & U01() 
\end{eqnarray*}
where $k \in \bar{g} \mathcal{R}$, and
\[
\bm{\chi}_k = 0
\]
for other values of $k$. \newline

This installs some random values in some specific positions in array of $\bm{\chi}$ according to value of $g$ 
and others set to $0$. Normalization of $\bm{\chi}_k$ gives values for $chi$ distribution 
\[
\bm{\chi}_k = \bm{\chi}_k/\sum\limits_{k \in \mathcal{R}} \bm{\chi}_k
\]
such that 
\[
\sum\limits_{k \in \mathcal{R}} \bm{\chi}_k = 1.
\]
The values $\bm{\chi}_k$ satisfy condition (\ref{OscCond}) for $\bm{\chi}$ distribution.

\section{Initial Population}
\label{InitPopOsc}

\begin{figure}[H]
\begin{center}
\resizebox*{12cm}{!}{\includegraphics{figures/eps/initialpop.eps}}\hspace{4pt}
\caption{\textbf{Initial population computation} }
\label{initialpop}
\end{center}
\end{figure}

Let finite haploid population $\bm{s}^n$, finite diploid population $\bm{f}^n$, infinite haploid population $\bm{p}^n$ 
and infinite haploid population $\bm{q}^n$ be considered with initial population $\bm{s}^0$, $\bm{f}^0$,
$\bm{p}^0$, $\bm{q}^0$ respectively. To investigate oscillating behavior of infinite population evolutionary limits 
and finite population, same initial population is desired. 

For a genome length $\ell$, let $x = 2^\ell$ be number of possible strings in finite haploid population array $\bm{t}$ of 
population size $N$. Possible strings $\bm{t}_i$ are ${0, 1,.., x-1}$ where $i = 0, 1,.., N-1$. An arbitrary vector $\bm{f}$ of size $x$ 
was considered where
\[
\bm{r}_i = U01(); \tabspace {i = 0, 1,.., x-1}
\]
and U01() is random number between 0 and 1.
Let $\bm{t}$ represent finite haploid population strings array.
\[
\bm{t}_j = randp(\bm{r}) ; \tabspace {j = 0,.., N-1}
\]
where $\bm{t}_j$ is $j^{th}$ population member and $randp(\bm{r})$ returns random index $i$ in array $\bm{r}$ with probability $\bm{r}_i$.

Let $\bm{c}_i$ represent count of haploid member $i$ in population $\bm{t}$ given by
\[
\bm{c}_i = \sum \limits_{j=0}^{N-1} [\bm{t}_j = i]  \nudge; \tabspace  {i = 0,.., x-1} \text{ and  [..]  is  Iverson bracket.}
\]

Then infinite population vector $\bm{p}$ is calculated as
\[
\bm{p}_i = \frac{\bm{c}_i}{ \sum \limits_{k=0}^{x-1} \bm{c}_k }
\]
where $i = 0,.., x-1$ and $\sum \limits_{k=0}^{x-1} \bm{c}_k = N$.

This $\bm{p}$ is randomly generated initial infinite haploid population vector ($\bm{p}^0$) which corresponds to diploid infinite population vector $\bm{q}$ 
and finite population vectors $\bm{s}$ and $\bm{f}$.

Finite haploid population members $\bm{t}_j$s are generated again to match finite haploid population $\bm{s}^0$ with infinite haploid population $\bm{p}^0$.
\[
\bm{c}_i = N \cdot \bm{p}_i 
\]
\[
\sum \limits_{j=0}^{N-1} [\bm{t}_j = i] = \bm{c}_i  \nudge; \tabspace  {i = 0,.., x-1} 
\]

Initial infinite diploid population $\bm{q}_0$ is calculated corresponding to initial haploid population $\bm{p}^0$ as
\[
\bm{q}_{i,j} = \bm{p}_i \cdot \bm{p}_j  \nudge; \tabspace  {i = 0,..,x-1; \tabspace j = 0,..,x-1}.
\]

Let $\bm{v}$ represent finite diploid population member array of size $N^2$ and $\bm{d}_{i,j}$ represent count of 
diploid member $\langle i,j \rangle$ in $\bm{v}$. Then $\bm{v}$ can be filled with population member to match 
initial population vector $\bm{p}$ generating diploid members such that
\begin{eqnarray*}
\bm{d}_{i,j} & = & N \cdot \bm{p}_i \cdot N \cdot \bm{p}_j  \\
\sum \limits_{k=0}^{N^2-1} [ \bm{v}_k = \langle i,j \rangle ] & = & \bm{d}_{i,j}
\end{eqnarray*}

Finite diploid population vector $\bm{f}$ can be obtained from finite diploid population member array $\bm{v}$  using
\[
f_{i,j} = \frac{\bm{d}_{i,j}}{\sum \limits_{k=0}^{x-1} \sum \limits_{h=0}^{x-1} \bm{d}_{k,h}}
\]
where $i = 0,.., x-1$, $h = 0,.., x-1$ and $\sum \limits_{k=0}^{x-1} \sum \limits_{h=0}^{x-1} \bm{d}_{k,h} = N^2$.

This initial infinite haploid population vector $\bm{p}^0$ corresponds to initial infinite diploid population vector $\bm{q}^0$, initial finite 
haploid population vector with population size $N$ and initial finite diploid population vector $N^2$ with population size $N^2$.

\section{Oscillation}
\label{Oscillation}

Equations (\ref{lt1}) and (\ref{lt2}) were implemented with crossover distribution $\bm{\chi}$ and mutation distribution $\bm{\mu}$ satisfying 
condition (\ref{OscCond}) to investigate oscillating behavior of predicted infinite population evolutionary limits $\bm{p}^{\ast}$ and $\bm{q}^{\ast}$ 
and finite population under no selective pressure.

Infinite haploid population evolutionary limits $\bm{p}_h^{\ast}$ and $\bm{q}_h^{\ast}$ were computed using equations (\ref{lt1}) and (\ref{lt2}). 
Infinite diploid population evolutionary limits $\bm{p}_d^{\ast}$ and $\bm{q}_d^{\ast}$ as
\begin{eqnarray*}
{\bm{p}_d^{\ast}}_{\langle \gamma_0, \gamma_1 \rangle} & = & {\bm{p}_h^{\ast}}_{\gamma_0} {\bm{p}_h^{\ast}}_{\gamma_1} \\
{\bm{q}_d^{\ast}}_{\langle \gamma_0, \gamma_1 \rangle} & = & {\bm{q}_h^{\ast}}_{\gamma_0} {\bm{q}_h^{\ast}}_{\gamma_1}
\end{eqnarray*}
where $\gamma = \langle \gamma_0, \gamma_1 \rangle$ is diploid genome.

For a genome length $\ell$, same initial population (calculated as described in (\ref{InitPopOsc})) was used for infinite population and all 
sizes of finite population conisdered.
Genome lengths $\ell = {8, 10, 12, 14}$ were used. Base population size of $N_0 = 64$ was considered for finite haploid case and 
different population sizes $N = \{1N_0^2, 10N_0^2, 20N_0^2\}$ were considered for plotting graphs. 
The distances of $\bm{p}^n$ and $\bm{s}^n$ to haploid evolutionary limits $\bm{p}_h^{\ast}$ and $\bm{q}_h^{\ast}$ were plotted and the distances of $\bm{q}^n$ and 
$\bm{f}^n$ to diploid evolutionary limits $\bm{p}_d^{\ast}$ and $\bm{q}_d^{\ast}$ were plotted.


%oscillation
\input{chapters/oscillation.tex}


\textbf{ Figures} \ref{oscillation_8h}, \ref{oscillation_8d}, \ref{oscillation_10h}, \ref{oscillation_10d}, \ref{oscillation_12h}, \ref{oscillation_12d}, 
\ref{oscillation_14h} and \ref{oscillation_14d} arranged by genome length $\ell$ 
and sub-figures within each figures arranged by population size ($N$) for finite population for haploid and diploid population 
depticts oscillating behavior of both infinite and finite population when necessary and sufficient condition \ref{OscCond} is met. 
Oscillation in finite population in both haploid and diploid case simulation became sharper with increased population size as expected. 
As size of finite population increased, oscillation behavior depicted by finite population is more similar to oscillation behavior depicted by infinite population. 

Graphs for distance between finite population and infinite population for both haploid and diploid case were also plotted for 
each generation on right side of oscillation graphs in above figures. The resulting graphs showed distance decreased as population size increased 
which is expected and in congruence with results from \ref{convergence}. 

Numerator $\sqrt{(1 - \|\mathcal{G}(\bm{p})\|^2)}$ in equation \ref{convergenceRHS} is calculated using initial population and is $\approx 1$. 
So from \ref{convergenceRHS}, the expected distance between finite and infinite population, $d$, can be calculated as
\[
d \approx 1/\sqrt{N}
\]
where $N$ is size of finite population.
Then mathematical expection of distance for finite population size considered for plotting is shown in following table.
\begin{table}[ht]
\caption{Expected distance for population size}
\centering
\begin{tabular}{c c c c}
\hline
$N$ & 4096 & 40960 & 81920 \\
$d$ & 0.015625 & 0.004941 & 0.003494 \\
\hline
\end{tabular}
\label{tableExpectedDistance}
\end{table}

The distance graphs, obtained from simulations, in \textbf{ Figures} \ref{oscillation_8h}, \ref{oscillation_8d}, \ref{oscillation_10h}, 
\ref{oscillation_10d}, \ref{oscillation_12h}, \ref{oscillation_12d}, \ref{oscillation_14h} and \ref{oscillation_14d}  for 
finite population sizes $N = {4096, 40960, 81920}$ shows distance similar to expected distance given by table \ref{tableExpectedDistance}.





\newpage

\section{Violation}

The results showed when $\bm{\chi}$ and $\bm{\mu}$ distributions satisfies (\ref{OscCond}), oscillation occurs in both infinite and finite population. 
Error $\epsilon$ was introduced to $\bm{\mu}$ distribution and $\bm{\chi}$ distribution such that (\ref{OscCond}) did not satisfy anymore and 
$x_g \neq −1$ for all $g$ ($x_g$ and $g$ defined in \ref{Limits}) so that $\bm{p}^\ast = \bm{q}^\ast$.

$\bm{\mu}$ distribution was treated with $\epsilon$ such that
\[
\bm{\mu}_i = (1-\epsilon) \bm{\mu}_i \nudge; \tabspace i = \{0, 1, 2,.., 2^{\ell}-1\}.
\]
So that sum of $\bm{\mu}$ distribution becomes, 
\[
1-\epsilon = \sum \limits_{i=0}^{2^{\ell}-1} \bm{\mu}_i
\]
Then set
\[
\bm{\mu}_0 = \epsilon
\]

$\bm{\chi}$ distribution was treated with $\epsilon$ such that
\[
\bm{\chi}_i = (1-\epsilon) \bm{\chi} ; \tabspace i = \{1, 2,.., 2^{\ell}-1\} 
\]
So that 
\[
\bm{\chi}_i + \bm{\chi}_{i+g} = 1-\epsilon ; \tabspace g \text{ is defined in  section } \ref{Limits}
\]

Then $j$ is chosen where $\bm{\chi}_j = 0$ and set $\bm{\chi}_j = \epsilon$. \newline

Simulations were run again with the violations in (\ref{OscCond}) implemented. Genome lengths $\ell = {8, 10, 12, 14}$ were considered. 
Different finite hapliod population sizes $N = \{1N_0^2, 10N_0^2, 20N_0^2\}$ were considered. 
\newline
Let ${\bm{p}1}^{\ast}$ and ${\bm{q}1}^{\ast}$ be evolutionary limits with violation, 
then ${\bm{p}1}^{\ast} = {\bm{q}1}^{\ast} = {\bm{z}}^\ast$; $\bm{z}^\ast$ is limit when there is violation.
The distances of ${p}^n$ and $\bm{s}^n$ to $\bm{z}^\ast$ were plotted and the distances of 
$\bm{q}^n$ and $\bm{f}^n$ to $\bm{z}^\ast$ were plotted. The distances of population to evolutionary limits that would be 
without violation in $\mu$ and $\chi$ were also plotted.


% figures for mu violation
\input{chapters/violation-mu.tex}

% figures for chi violation
\input{chapters/violation-chi.tex}

First columns of graphs above for violation in $\mu$ and in $\chi$ show distance of finite and infinite population to evolutionary limits with violation and 
second columns show distance of distance of finite and infinite population to evolutionary limits that would be without violation. 

Graphs in first columns (distance of finite and infinite population to evolutionary limits with violation) shows distance between finite population 
and limit with violation $\bm{z}^\ast$ decreases as finite population size increases and converging to infinite population behavior as finite population reach large number. 
The rate of convergence of finite population matches with expected rate of convergence calculated by \cite{Vose1999b} which is shown in table \ref{tableExpectedDistance}.

Second columns of graphs gives clearer picture of oscillating behavior of population with violation in $\mu$ or $\chi$ distribution. 
Since distance plotted is to evolutionary limits that would be if there were no violation, two lines oscillating are visible. Infinite population oscillates but ripples die out gradually as generation increases, that infinite population is converging to limit with violation $\bm{z}^\ast$. As finite population size increases, its behavior converges to that of infinite population. 

Change in oscillating behavior of population with change in $\epsilon$ values $\{0.01, 0.1, 0.5\}$ were also studied. With smaller values of $\epsilon$, 
oscillation were sharper and as value of $\epsilon$ increased, rate of damping of ripples was quicker. Error $\epsilon$ introduced 
to $\mu$ or $\chi$ distribution creates new masks (different than in case of without violation) to be used in mutation or crossover during transmission.
With small $\epsilon$, the probablility of using the new masks available due to violation is very small and 
those masks might not be used at all during crossover or mutation in finite population and with higher values of $\epsilon$, 
those new masks have higher chance of usage during mutation or crossover which cause oscillation to die out quickly. In figures for violation in $\mu$ distribution, with $\epsilon = 0.01$, oscillation is clearly visible and ripples are sharper; with $\epsilon = 0.1$ oscillation was visible but ripples were damping out quickly;  with $\epsilon = 0.5$,
oscillation was not visible. Damping out of ripples and converging to infinite population behavior increased as population size increased. 










 
